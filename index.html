<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog do Vakeiro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.4.0/dist/email.min.js"></script>
</head>
<body>
    <header>
        <h1>Blog do Vakeiro</h1>
    </header>

    <!-- Página de Login -->
    <div id="login-area">
        <h2>Login Admin</h2>
        <button onclick="login()">Login</button>
    </div>

    <!-- Página de Manutenção -->
    <div id="manutencao" style="display:none;">
        <h1>Site em Manutenção. Volte em breve!</h1>
        <button onclick="mostrarLogin()">Entrar</button>
    </div>

    <!-- Painel Admin -->
    <div id="admin-panel" style="display:none;">
        <h2>Painel de Administração</h2>
        <button onclick="criarPostagem()">Criar Nova Postagem</button>
        <button onclick="desativarSite()">Desativar Site</button>
        <button onclick="ativarSite()">Ativar Site</button>
        <div id="ip-info"></div>
        <div id="blog-area"></div>
    </div>

    <!-- Scripts -->
    <script>
        const adminUsuarios = {
            "Gabbz": "230112",
            "Vakeiro": "melhorstreamerdomundo"
        };

        let siteAtivo = localStorage.getItem('siteAtivo') === 'true'; // Recupera o estado do site

        // Se não estiver ativo, mostra a manutenção
        if (!siteAtivo) {
            document.getElementById('manutencao').style.display = 'block';
        } else {
            document.getElementById('admin-panel').style.display = 'block';
        }

        function login() {
            let usuario = prompt("Digite seu nome de usuário:");
            let senha = prompt("Digite sua senha:");

            if (adminUsuarios[usuario] === senha) {
                alert("Login bem-sucedido!");
                document.getElementById('login-area').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                mostrarInformacoesIP();
                carregarPostagens(); // Carregar postagens armazenadas
            } else {
                alert("Usuário ou senha incorretos!");
            }
        }

        // Função para ativar o site
        function ativarSite() {
            siteAtivo = true;
            localStorage.setItem('siteAtivo', 'true');  // Salva o estado do site
            document.getElementById('manutencao').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
        }

        // Função para desativar o site
        function desativarSite() {
            siteAtivo = false;
            localStorage.setItem('siteAtivo', 'false');  // Salva o estado do site
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('manutencao').style.display = 'block';
        }

        // Mostra a página de login
        function mostrarLogin() {
            let loginArea = document.getElementById('login-area');
            loginArea.style.display = 'block';
            document.getElementById('manutencao').style.display = 'none';
        }

        // Cria nova postagem no blog
        function criarPostagem() {
            let titulo = prompt("Digite o título da postagem:");
            let conteudo = prompt("Digite o conteúdo da postagem:");
            
            let postagens = JSON.parse(localStorage.getItem('postagens')) || []; // Recupera as postagens existentes

            // Adiciona a nova postagem
            postagens.push({ titulo, conteudo });

            // Salva novamente no localStorage
            localStorage.setItem('postagens', JSON.stringify(postagens));

            // Recarrega as postagens
            carregarPostagens();
        }

        // Carrega as postagens salvas do localStorage
        function carregarPostagens() {
            let postagens = JSON.parse(localStorage.getItem('postagens')) || [];
            let blogArea = document.getElementById('blog-area');
            blogArea.innerHTML = ''; // Limpa o conteúdo atual

            postagens.forEach(post => {
                let postDiv = document.createElement('div');
                postDiv.innerHTML = `<h2>${post.titulo}</h2><p>${post.conteudo}</p><button onclick="excluirPostagem(this)">Excluir</button>`;
                blogArea.appendChild(postDiv);
            });
        }

        // Exclui a postagem do blog
        function excluirPostagem(button) {
            let postagens = JSON.parse(localStorage.getItem('postagens')) || [];
            let index = Array.from(button.parentElement.parentElement.children).indexOf(button.parentElement);

            postagens.splice(index, 1); // Remove a postagem

            // Atualiza no localStorage
            localStorage.setItem('postagens', JSON.stringify(postagens));

            // Recarrega as postagens
            carregarPostagens();
        }

        // Mostra as informações do IP
        function mostrarInformacoesIP() {
            fetch('https://api.ipgeolocation.io/ipgeo?apiKey=f1c747ab534f49b29d9967da9bb023b7')
                .then(response => response.json())
                .then(data => {
                    let ipInfo = document.getElementById('ip-info');
                    ipInfo.innerHTML = `<p>IP: ${data.ip}</p><p>Cidade: ${data.city}</p><p>Estado: ${data.state_prov}</p>`;
                    enviarEmail(data);
                });
        }

        // Envia um email com as informações do IP
        function enviarEmail(data) {
            emailjs.send("service_9lds88h", "YOUR_TEMPLATE_ID", {
                ip: data.ip,
                cidade: data.city,
                estado: data.state_prov
            })
            .then(response => console.log("E-mail enviado com sucesso!", response))
            .catch(error => console.log("Erro ao enviar e-mail", error));
        }
    </script>
</body>
</html>
